name: CI/CD Pipeline for React Web App

on:
  push:
    branches:
      - main

jobs:
  SonarCloudScan:
    name: SonarCloudScan
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Install Dependencies
        run: npm install

      - name: SonarCloud Scan
        uses: sonarsource/sonarcloud-github-action@master
        with:
          projectBaseDir: .
          args: >
            -Dsonar.organization=my-org
            # -Dsonar.projectKey=sample-webapp
        env:
          GITHUB_TOKEN: ${{ secrets.GIT_TOKEN }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

      - name: Code Analysis
        run: npm run lint

      - name: Check Analysis Status
        run: |
          if [ $? -ne 0 ]; then
            echo "Code analysis failed."
            exit 1
          fi

      - name: Build
        run: npm run build

      - name: Deploy
        # Replace this with your deployment script or commands
        run: |
          # Example: Deploy to Firebase Hosting
          # npm install -g firebase-tools
          # firebase login:ci --no-localhost --token "$FIREBASE_TOKEN"
          # firebase deploy --token "$FIREBASE_TOKEN" --only hosting
          echo "Deployment script goes here..."

      - name: Generate Report
        if: failure()
        run: |
          echo "Code analysis failed. Generating report..."
          # Example: Save logs to a file or print additional diagnostics
          # cat lint.log

